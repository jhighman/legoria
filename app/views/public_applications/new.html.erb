<% content_for(:title) { "Apply for #{@job.title}" } %>

<div class="bg-light border-bottom py-4">
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><%= link_to "Careers", careers_path %></li>
        <li class="breadcrumb-item"><%= link_to @job.title, career_path(@job) %></li>
        <li class="breadcrumb-item active">Apply</li>
      </ol>
    </nav>
  </div>
</div>

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-header bg-white">
          <h4 class="mb-0">
            <i class="bi bi-file-earmark-person me-2"></i>Apply for <%= @job.title %>
          </h4>
        </div>
        <div class="card-body">
          <% if @candidate&.errors&.any? || @application&.errors&.any? %>
            <div class="alert alert-danger">
              <h6 class="alert-heading">Please fix the following errors:</h6>
              <ul class="mb-0">
                <% @candidate&.errors&.full_messages&.each do |error| %>
                  <li><%= error %></li>
                <% end %>
                <% @application&.errors&.full_messages&.each do |error| %>
                  <li><%= error %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <%= form_with url: apply_career_path(@job), method: :post, local: true, multipart: true do |f| %>
            <h5 class="border-bottom pb-2 mb-3">Personal Information</h5>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">First Name <span class="text-danger">*</span></label>
                <%= f.fields_for :candidate, @candidate do |cf| %>
                  <%= cf.text_field :first_name, class: "form-control #{'is-invalid' if @candidate&.errors&.include?(:first_name)}", required: true %>
                <% end %>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Last Name <span class="text-danger">*</span></label>
                <%= f.fields_for :candidate, @candidate do |cf| %>
                  <%= cf.text_field :last_name, class: "form-control #{'is-invalid' if @candidate&.errors&.include?(:last_name)}", required: true %>
                <% end %>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Email Address <span class="text-danger">*</span></label>
                <%= f.fields_for :candidate, @candidate do |cf| %>
                  <%= cf.email_field :email, class: "form-control #{'is-invalid' if @candidate&.errors&.include?(:email)}", required: true %>
                <% end %>
                <div class="form-text">We'll send your application confirmation here.</div>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Phone Number</label>
                <%= f.fields_for :candidate, @candidate do |cf| %>
                  <%= cf.telephone_field :phone, class: "form-control" %>
                <% end %>
              </div>
            </div>

            <h5 class="border-bottom pb-2 mb-3 mt-4">Professional Information</h5>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Current Company</label>
                <%= f.fields_for :candidate, @candidate do |cf| %>
                  <%= cf.text_field :current_company, class: "form-control" %>
                <% end %>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Current Title</label>
                <%= f.fields_for :candidate, @candidate do |cf| %>
                  <%= cf.text_field :current_title, class: "form-control" %>
                <% end %>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">LinkedIn Profile</label>
                <%= f.fields_for :candidate, @candidate do |cf| %>
                  <%= cf.url_field :linkedin_url, class: "form-control", placeholder: "https://linkedin.com/in/..." %>
                <% end %>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Portfolio / Website</label>
                <%= f.fields_for :candidate, @candidate do |cf| %>
                  <%= cf.url_field :portfolio_url, class: "form-control", placeholder: "https://..." %>
                <% end %>
              </div>
            </div>

            <h5 class="border-bottom pb-2 mb-3 mt-4">Resume & Cover Letter</h5>

            <div class="mb-3">
              <label class="form-label">Resume <span class="text-danger">*</span></label>
              <%= file_field_tag :resume, class: "form-control", accept: ".pdf,.doc,.docx", required: true %>
              <div class="form-text">Accepted formats: PDF, DOC, DOCX (max 10MB)</div>
            </div>

            <div class="mb-3">
              <label class="form-label">Cover Letter</label>
              <%= f.fields_for :candidate, @candidate do |cf| %>
                <%= cf.text_area :cover_letter, class: "form-control", rows: 6, placeholder: "Tell us why you're interested in this position..." %>
              <% end %>
            </div>

            <h5 class="border-bottom pb-2 mb-3 mt-4">Additional Information</h5>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">How did you hear about us?</label>
                <%= select_tag :source_type,
                    options_for_select([
                      ["Career Site", "career_site"],
                      ["Job Board", "job_board"],
                      ["LinkedIn", "linkedin"],
                      ["Referral", "referral"],
                      ["Company Website", "direct"],
                      ["Other", "other"]
                    ], params[:source_type] || "career_site"),
                    class: "form-select" %>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Referral Code (if applicable)</label>
                <%= text_field_tag :referral_code, params[:referral_code] || params[:ref], class: "form-control", placeholder: "Enter referral code" %>
              </div>
            </div>

            <hr class="my-4">

            <div class="form-check mb-4">
              <input type="checkbox" class="form-check-input" id="termsCheck" required>
              <label class="form-check-label" for="termsCheck">
                I confirm that the information provided is accurate and I agree to the
                <a href="#" target="_blank">Privacy Policy</a> and
                <a href="#" target="_blank">Terms of Service</a>.
                <span class="text-danger">*</span>
              </label>
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-between">
              <%= link_to career_path(@job), class: "btn btn-outline-secondary" do %>
                <i class="bi bi-arrow-left me-1"></i> Back to Job
              <% end %>
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="bi bi-send me-2"></i>Submit Application
              </button>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
