<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h3 mb-1">Users</h1>
    <p class="text-muted mb-0">Manage organization users and their roles</p>
  </div>
  <%= link_to new_admin_user_path, class: "btn btn-primary" do %>
    <i class="bi bi-plus me-1"></i> New User
  <% end %>
</div>

<!-- Filters -->
<div class="card mb-4">
  <div class="card-body">
    <%= form_with url: admin_users_path, method: :get, local: true, class: "row g-3 align-items-end" do %>
      <div class="col-md-4">
        <label class="form-label">Search</label>
        <%= text_field_tag :q, params[:q], class: "form-control", placeholder: "Name or email..." %>
      </div>
      <div class="col-md-2">
        <label class="form-label">Role</label>
        <%= select_tag :role, options_for_select([["All Roles", ""]] + current_user.organization.roles.pluck(:name, :name), params[:role]), class: "form-select" %>
      </div>
      <div class="col-md-2">
        <label class="form-label">Status</label>
        <%= select_tag :status, options_for_select([["All", ""], ["Active", "active"], ["Inactive", "inactive"]], params[:status]), class: "form-select" %>
      </div>
      <div class="col-md-4">
        <%= submit_tag "Filter", class: "btn btn-outline-secondary" %>
        <%= link_to "Clear", admin_users_path, class: "btn btn-link" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Users List -->
<div class="card">
  <div class="table-responsive">
    <table class="table table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th>User</th>
          <th>Email</th>
          <th>Roles</th>
          <th>Status</th>
          <th>Last Sign In</th>
          <th class="text-end">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @users.each do |user| %>
          <tr>
            <td>
              <div class="d-flex align-items-center">
                <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center" style="width: 36px; height: 36px;">
                  <span class="small"><%= user.first_name[0] %><%= user.last_name[0] %></span>
                </div>
                <div class="ms-3">
                  <div class="fw-medium"><%= user.display_name %></div>
                </div>
              </div>
            </td>
            <td><%= user.email %></td>
            <td>
              <% user.roles.each do |role| %>
                <span class="badge bg-secondary me-1"><%= role.name.humanize %></span>
              <% end %>
              <% if user.roles.empty? %>
                <span class="text-muted">No roles</span>
              <% end %>
            </td>
            <td>
              <% if user.active? %>
                <span class="badge bg-success">Active</span>
              <% else %>
                <span class="badge bg-secondary">Inactive</span>
              <% end %>
            </td>
            <td class="text-muted small">
              <%= user.last_sign_in_at ? time_ago_in_words(user.last_sign_in_at) + " ago" : "Never" %>
            </td>
            <td class="text-end">
              <%= link_to "Edit", edit_admin_user_path(user), class: "btn btn-sm btn-outline-secondary" %>
              <% if user.active? && user != current_user %>
                <%= button_to deactivate_admin_user_path(user), method: :patch, class: "btn btn-sm btn-outline-danger", data: { turbo_confirm: "Deactivate this user?" } do %>
                  Deactivate
                <% end %>
              <% elsif !user.active? %>
                <%= button_to activate_admin_user_path(user), method: :patch, class: "btn btn-sm btn-outline-success" do %>
                  Activate
                <% end %>
              <% end %>
            </td>
          </tr>
        <% end %>
        <% if @users.empty? %>
          <tr>
            <td colspan="6" class="text-center py-5">
              <i class="bi bi-people fs-1 text-muted d-block mb-3"></i>
              <h5>No users found</h5>
              <p class="text-muted">Try adjusting your search or filters</p>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
