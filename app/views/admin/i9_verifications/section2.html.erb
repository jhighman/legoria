<% content_for :title, "Complete Section 2 - #{@i9_verification.candidate.full_name}" %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h3 mb-1">Complete Section 2</h1>
    <p class="text-muted mb-0">Employer Review and Verification - <%= @i9_verification.candidate.full_name %></p>
  </div>
  <%= link_to "Back", admin_i9_verification_path(@i9_verification), class: "btn btn-outline-secondary" %>
</div>

<% if @i9_verification.deadline_section2 && @i9_verification.deadline_section2 < Date.current %>
  <div class="alert alert-danger mb-4">
    <strong>Warning:</strong> This I-9 is past the Section 2 deadline (<%= @i9_verification.deadline_section2.strftime("%B %d, %Y") %>).
    A late completion reason is required.
  </div>
<% end %>

<%= form_with model: @i9_verification, url: complete_section2_admin_i9_verification_path(@i9_verification), method: :post, local: true do |f| %>
  <div class="row">
    <div class="col-md-8">
      <!-- Employee Section 1 Summary -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h5 class="card-title mb-0">Employee Information (Section 1)</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <p><strong>Name:</strong> <%= @i9_verification.candidate.full_name %></p>
              <p><strong>Citizenship Status:</strong> <%= @i9_verification.citizenship_status&.titleize&.gsub("_", " ") %></p>
            </div>
            <div class="col-md-6">
              <p><strong>Start Date:</strong> <%= @i9_verification.employee_start_date&.strftime("%B %d, %Y") %></p>
              <p><strong>Section 1 Completed:</strong> <%= @i9_verification.section1_completed_at&.strftime("%B %d, %Y") %></p>
            </div>
          </div>
        </div>
      </div>

      <!-- Document Verification -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="card-title mb-0">Document Verification</h5>
        </div>
        <div class="card-body">
          <div class="alert alert-info">
            <strong>Instructions:</strong> Examine documents from List A OR a combination of List B and List C.
            Enter the document information below.
          </div>

          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
              <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#listA" type="button">List A (Identity + Work Auth)</button>
            </li>
            <li class="nav-item">
              <button class="nav-link" data-bs-toggle="tab" data-bs-target="#listBC" type="button">List B + C</button>
            </li>
          </ul>

          <div class="tab-content mt-3">
            <div class="tab-pane fade show active" id="listA">
              <p class="text-muted">Documents that establish both identity and employment authorization</p>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Document Type</label>
                  <select name="documents[][document_type]" class="form-select">
                    <option value="">Select Document</option>
                    <option value="us_passport">U.S. Passport</option>
                    <option value="us_passport_card">U.S. Passport Card</option>
                    <option value="permanent_resident_card">Permanent Resident Card</option>
                    <option value="foreign_passport_i94">Foreign Passport with I-94</option>
                    <option value="employment_authorization_document">Employment Authorization Document</option>
                  </select>
                  <input type="hidden" name="documents[][list_type]" value="list_a">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Document Number</label>
                  <input type="text" name="documents[][document_number]" class="form-control">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Issuing Authority</label>
                  <input type="text" name="documents[][issuing_authority]" class="form-control">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Expiration Date</label>
                  <input type="date" name="documents[][expiration_date]" class="form-control">
                </div>
              </div>
            </div>

            <div class="tab-pane fade" id="listBC">
              <div class="row">
                <div class="col-md-6">
                  <h6>List B (Identity)</h6>
                  <div class="mb-3">
                    <label class="form-label">Document Type</label>
                    <select name="documents[][document_type]" class="form-select list-b-doc">
                      <option value="">Select Document</option>
                      <option value="drivers_license">Driver's License</option>
                      <option value="state_id">State ID Card</option>
                      <option value="school_id">School ID with Photo</option>
                      <option value="military_id">U.S. Military Card</option>
                    </select>
                    <input type="hidden" name="documents[][list_type]" value="list_b" class="list-b-hidden">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Document Number</label>
                    <input type="text" name="documents[][document_number]" class="form-control">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Expiration Date</label>
                    <input type="date" name="documents[][expiration_date]" class="form-control">
                  </div>
                </div>
                <div class="col-md-6">
                  <h6>List C (Work Authorization)</h6>
                  <div class="mb-3">
                    <label class="form-label">Document Type</label>
                    <select name="documents[][document_type]" class="form-select list-c-doc">
                      <option value="">Select Document</option>
                      <option value="social_security_card">Social Security Card (unrestricted)</option>
                      <option value="birth_certificate">Birth Certificate</option>
                      <option value="citizenship_certificate">Certificate of Citizenship</option>
                      <option value="employment_authorization">Employment Authorization (USCIS)</option>
                    </select>
                    <input type="hidden" name="documents[][list_type]" value="list_c" class="list-c-hidden">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Document Number</label>
                    <input type="text" name="documents[][document_number]" class="form-control">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Expiration Date (if any)</label>
                    <input type="date" name="documents[][expiration_date]" class="form-control">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Employer Certification -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="card-title mb-0">Employer Certification</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <%= f.label :employer_title, "Your Title", class: "form-label" %>
              <%= f.text_field :employer_title, class: "form-control", required: true %>
            </div>
            <div class="col-md-6 mb-3">
              <%= f.label :employer_organization_name, "Organization Name", class: "form-label" %>
              <%= f.text_field :employer_organization_name, class: "form-control", value: current_organization.name, required: true %>
            </div>
            <div class="col-12 mb-3">
              <%= f.label :employer_organization_address, "Organization Address", class: "form-label" %>
              <%= f.text_field :employer_organization_address, class: "form-control", required: true %>
            </div>
          </div>

          <% if @i9_verification.deadline_section2 && @i9_verification.deadline_section2 < Date.current %>
            <div class="mb-3">
              <%= f.label :late_reason, "Late Completion Reason", class: "form-label" %>
              <%= f.text_area :late_reason, class: "form-control", rows: 2, required: true, placeholder: "Explain why Section 2 was completed after the deadline..." %>
            </div>
          <% end %>

          <div class="alert alert-warning">
            <strong>Certification:</strong> I attest, under penalty of perjury, that (1) I have examined the documents presented by the employee,
            (2) the documents appear to be genuine and relate to the employee, and (3) the employee is authorized to work in the United States.
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card position-sticky" style="top: 1rem;">
        <div class="card-header">
          <h5 class="card-title mb-0">Submission</h5>
        </div>
        <div class="card-body">
          <p class="text-muted">By submitting this form, you are certifying that you have examined the employee's documents and they appear genuine.</p>
          <div class="d-grid">
            <%= f.submit "Complete Section 2", class: "btn btn-primary btn-lg" %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>
