<% content_for :title, "Recruiter Productivity Report" %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-1">
        <li class="breadcrumb-item"><%= link_to "Operational", reports_operational_index_path %></li>
        <li class="breadcrumb-item active">Recruiter Productivity</li>
      </ol>
    </nav>
    <h1 class="h3 mb-0">Recruiter Productivity</h1>
  </div>
  <%= render "reports/shared/export_buttons",
        csv_path: export_reports_operational_index_path(type: "productivity", **request.query_parameters) %>
</div>

<%= render "reports/shared/date_range_filter" %>

<!-- Summary Cards -->
<div class="row g-4 mb-4">
  <div class="col-md-2">
    <div class="card h-100">
      <div class="card-body text-center">
        <div class="h3 mb-0 text-primary"><%= @data[:summary][:active_recruiters] %></div>
        <small class="text-muted">Active Recruiters</small>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card h-100">
      <div class="card-body text-center">
        <div class="h3 mb-0 text-success"><%= @data[:summary][:total_hires] %></div>
        <small class="text-muted">Total Hires</small>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card h-100">
      <div class="card-body text-center">
        <div class="h3 mb-0 text-info"><%= @data[:summary][:total_interviews_scheduled] %></div>
        <small class="text-muted">Interviews</small>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card h-100">
      <div class="card-body text-center">
        <div class="h3 mb-0 text-warning"><%= @data[:summary][:total_offers_made] %></div>
        <small class="text-muted">Offers Made</small>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card h-100 bg-light">
      <div class="card-body text-center">
        <div class="h3 mb-0"><%= @data[:summary][:avg_hires_per_recruiter] %></div>
        <small class="text-muted">Avg Hires per Recruiter</small>
      </div>
    </div>
  </div>
</div>

<!-- Recruiter Table -->
<div class="card mb-4">
  <div class="card-header">
    <h5 class="card-title mb-0">Recruiter Breakdown</h5>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>Recruiter</th>
            <th class="text-end">Active Jobs</th>
            <th class="text-end">Applications</th>
            <th class="text-end">Stage Moves</th>
            <th class="text-end">Interviews</th>
            <th class="text-end">Offers</th>
            <th class="text-end">Hires</th>
            <th class="text-end">Conversion</th>
          </tr>
        </thead>
        <tbody>
          <% @data[:by_recruiter].each do |recruiter| %>
            <tr>
              <td><strong><%= recruiter[:recruiter_name] %></strong></td>
              <td class="text-end"><%= recruiter[:active_jobs] %></td>
              <td class="text-end"><%= recruiter[:applications_received] %></td>
              <td class="text-end"><%= recruiter[:stage_moves] %></td>
              <td class="text-end"><%= recruiter[:interviews_scheduled] %></td>
              <td class="text-end"><%= recruiter[:offers_made] %></td>
              <td class="text-end text-success fw-bold"><%= recruiter[:hires] %></td>
              <td class="text-end">
                <span class="badge bg-<%= recruiter[:conversion_rate] >= 10 ? 'success' : recruiter[:conversion_rate] >= 5 ? 'warning' : 'secondary' %>">
                  <%= recruiter[:conversion_rate] %>%
                </span>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Rankings -->
<div class="row g-4">
  <div class="col-md-4">
    <div class="card h-100">
      <div class="card-header bg-success text-white">
        <h6 class="card-title mb-0"><i class="bi bi-trophy me-2"></i>Most Hires</h6>
      </div>
      <ul class="list-group list-group-flush">
        <% @data[:rankings][:most_hires].each_with_index do |r, i| %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>
              <span class="badge bg-success me-2">#<%= i + 1 %></span>
              <%= r[:recruiter_name] %>
            </span>
            <span class="fw-bold"><%= r[:hires] %> hires</span>
          </li>
        <% end %>
      </ul>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card h-100">
      <div class="card-header bg-primary text-white">
        <h6 class="card-title mb-0"><i class="bi bi-graph-up me-2"></i>Best Conversion</h6>
      </div>
      <ul class="list-group list-group-flush">
        <% @data[:rankings][:highest_conversion].each_with_index do |r, i| %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>
              <span class="badge bg-primary me-2">#<%= i + 1 %></span>
              <%= r[:recruiter_name] %>
            </span>
            <span class="fw-bold"><%= r[:conversion_rate] %>%</span>
          </li>
        <% end %>
      </ul>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card h-100">
      <div class="card-header bg-info text-white">
        <h6 class="card-title mb-0"><i class="bi bi-lightning me-2"></i>Most Active</h6>
      </div>
      <ul class="list-group list-group-flush">
        <% @data[:rankings][:most_active].each_with_index do |r, i| %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>
              <span class="badge bg-info me-2">#<%= i + 1 %></span>
              <%= r[:recruiter_name] %>
            </span>
            <span class="fw-bold"><%= r[:stage_moves] + r[:interviews_scheduled] %> actions</span>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</div>
